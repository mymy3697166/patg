$.fn.extend({
  pagination: function(opts) {
    var pages = opts.pages;
    var index = opts.index||0;
    var showPages = opts.showPages||8;
    var onPageClick = opts.onPageClick||function(){};

    $(this).empty();
    $(this).append("<li e='f'" + (index == 0 ? " class='disabled'" : "") + "><a href='javascript:void(0)'>首页</a></li>");
    $(this).append("<li e='p'" + (index == 0 ? " class='disabled'" : "") + "><a href='javascript:void(0)'>上一页</a></li>");
    var pns = [0];
    var tpns = _.range(pages);
    if (pages <= showPages) pns = tpns;
    else {
      var hsp = Math.ceil(showPages / 2);
      if (index < hsp) pns = _.initial(tpns, pages - showPages);
      else if (index >= pages - hsp) pns = _.rest(tpns, pages - showPages);
      else pns = _.initial(_.rest(tpns, index - hsp + 1), pages - index - hsp);
    }
    for(var i in pns) {
      if(pns[i] == index) $(this).append("<li e='' class='active'><a href='javascript:void(0)'>" + (pns[i] + 1) + "</a></li>");
      else $(this).append("<li e='" + pns[i] + "'><a href='javascript:void(0)'>" + (pns[i] + 1) + "</a></li>");
    }
    $(this).append("<li e='n'" + (index == pages - 1 ? " class='disabled'" : "") + "><a href='javascript:void(0)'>下一页</a></li>");
    $(this).append("<li e='l'" + (index == pages - 1 ? " class='disabled'" : "") + "><a href='javascript:void(0)'>尾页</a></li>");
    
    $(this).undelegate("li", "click");
    $(this).delegate("li", "click", function() {
      var e = $(this).attr("e");
      if (e == "f" && index > 0) onPageClick(0);
      if (e == "p" && index > 0) onPageClick(index - 1);
      if ($.isNumeric(e)) onPageClick(parseInt(e));
      if (e == "n" && index < pages - 1) onPageClick(index + 1);
      if (e == "l" && index < pages - 1) onPageClick(pages - 1);
    });
  }
});

